'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var uuidv4 = _interopDefault(require('uuid/v4'));
var Web3 = _interopDefault(require('web3'));
var utils = require('web3-utils');
var React = require('react');
var React__default = _interopDefault(React);
var styled = require('styled-components');
var styled__default = _interopDefault(styled);
var styledComponentsTS = _interopDefault(require('styled-components-ts'));
var mobx = require('mobx');
var mobxReact = require('mobx-react');
var Web3Store = _interopDefault(require('@userfeeds/web3-store'));

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = Object.setPrototypeOf ||
    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }
    return t;
};

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __awaiter(thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
}

function getAccounts(web3Instance) {
    throwIfNotConnected(web3Instance);
    return web3Instance.eth.getAccounts();
}
function resolveOnTransactionHash(p) {
    return new Promise(function (resolve, reject) {
        p.on('error', reject).on('transactionHash', resolve);
    });
}
function throwIfNotConnected(web3Instance) {
    return __awaiter(this, void 0, void 0, function () {
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, web3Instance.eth.net.isListening()];
                case 1:
                    if (!(_a.sent())) {
                        throw Error('web3 is not connected');
                    }
                    return [2 /*return*/];
            }
        });
    });
}

var USERFEEDS_API_ADDRESS = 'https://api.userfeeds.io';
function sendClaim(web3Instance, claim) {
    return __awaiter(this, void 0, void 0, function () {
        var from, wrappedClaim, signatureValue, body, response, id;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, getAccounts(web3Instance)];
                case 1:
                    from = (_a.sent())[0];
                    wrappedClaim = JSON.stringify({ data: claim, creator: from.toLowerCase(), nonce: uuidv4() });
                    return [4 /*yield*/, web3Instance.eth.personal.sign(wrappedClaim, from)];
                case 2:
                    signatureValue = _a.sent();
                    body = JSON.stringify({ data: wrappedClaim, signatureValue: signatureValue, signatureType: 'ethereum:personal:sign' });
                    return [4 /*yield*/, fetch(USERFEEDS_API_ADDRESS + "/api/create-claim", {
                            method: 'POST',
                            body: body,
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        })];
                case 3:
                    response = _a.sent();
                    return [4 /*yield*/, response.text()];
                case 4:
                    id = _a.sent();
                    return [2 /*return*/, id];
            }
        });
    });
}

var web3 = new Web3('');
var setProviderIfAvailable = function () {
    if (typeof window.web3 !== 'undefined') {
        web3.setProvider(window.web3.currentProvider);
    }
    else {
        setTimeout(setProviderIfAvailable, 500);
    }
};
if (document.readyState === 'complete') {
    setProviderIfAvailable();
}
else {
    window.addEventListener('load', setProviderIfAvailable);
}

var tokenTransferContractAddressMapping = {
    ethereum: '0xfF8A1BA752fE5df494B02D77525EC6Fa76cecb93',
    rinkeby: '0xBd2A0FF74dE98cFDDe4653c610E0E473137534fB',
    ropsten: '0x54b4372fA0bd76664B48625f0e8c899Ff19DFc39',
    kovan: '0xd6Ede7F43882B100C6311a9dF801088eA91cEb64',
};
function getContractTokenTransferAddress(networkName) {
    var contractAddress = tokenTransferContractAddressMapping[networkName];
    if (!contractAddress) {
        throw new Error('Contract is not available');
    }
    return contractAddress;
}
function getErc20Contract(web3Instance, contractAddress) {
    var contract = new web3Instance.eth.Contract(erc20abi, contractAddress);
    contract.setProvider(web3Instance.currentProvider); // ToDo because of bug in web3 1.0.0-beta26
    return contract;
}
var erc20abi = [
    {
        constant: false,
        inputs: [{ name: '_spender', type: 'address' }, { name: '_value', type: 'uint256' }],
        name: 'approve',
        outputs: [{ name: 'success', type: 'bool' }],
        payable: false,
        type: 'function',
    },
    {
        constant: true,
        inputs: [{ name: '_owner', type: 'address' }, { name: '_spender', type: 'address' }],
        name: 'allowance',
        outputs: [{ name: '', type: 'uint256' }],
        payable: false,
        type: 'function',
    },
    {
        constant: true,
        inputs: [{ name: '_owner', type: 'address' }],
        name: 'balanceOf',
        outputs: [{ name: '', type: 'uint256' }],
        payable: false,
        type: 'function',
    },
    {
        constant: true,
        inputs: [],
        name: 'decimals',
        outputs: [{ name: '', type: 'uint8' }],
        payable: false,
        type: 'function',
    },
    {
        constant: true,
        inputs: [],
        name: 'name',
        outputs: [{ name: '', type: 'string' }],
        payable: false,
        type: 'function',
    },
    {
        constant: true,
        inputs: [],
        name: 'symbol',
        outputs: [{ name: '', type: 'string' }],
        payable: false,
        type: 'function',
    },
];

function erc20ContractAllowanceForAccount(web3Instance, contractAddress, spender, from) {
    return __awaiter(this, void 0, void 0, function () {
        var contract;
        return __generator(this, function (_a) {
            contract = getErc20Contract(web3Instance, contractAddress);
            return [2 /*return*/, contract.methods.allowance(from, spender).call()];
        });
    });
}
function erc20ContractBalanceForAccount(web3Instance, contractAddress, from) {
    return __awaiter(this, void 0, void 0, function () {
        var contract;
        return __generator(this, function (_a) {
            contract = getErc20Contract(web3Instance, contractAddress);
            return [2 /*return*/, contract.methods.balanceOf(from).call()];
        });
    });
}
function erc20ContractDecimals(web3Instance, contractAddress) {
    var contract = getErc20Contract(web3Instance, contractAddress);
    return contract.methods.decimals().call();
}
function erc20ContractName(web3Instance, contractAddress) {
    var contract = getErc20Contract(web3Instance, contractAddress);
    return contract.methods.name().call();
}
function erc20ContractSymbol(web3Instance, contractAddress) {
    var contract = getErc20Contract(web3Instance, contractAddress);
    return contract.methods.symbol().call();
}

var BN = utils.BN;
var MAX_VALUE_256 = new BN(2)
    .pow(new BN(256))
    .subn(1)
    .toString(10);
var toWei = function (amout, decimals) {
    var parsedDecimals = typeof decimals !== 'number'
        ? parseInt(decimals, 10) // ToDo check this casting
        : decimals;
    var multiplier = new BN(10).pow(new BN(parsedDecimals));
    var _a = amout.toString().split('.'), integral = _a[0], _b = _a[1], rawFraction = _b === void 0 ? '' : _b;
    var fraction = rawFraction.padEnd(parsedDecimals, '0').slice(0, parsedDecimals);
    return new BN(integral)
        .mul(multiplier)
        .add(new BN(fraction))
        .toString(10);
};

function allowanceUserfeedsContractTokenTransferForAccount(web3Instance, networkName, tokenContractAddress, from) {
    return __awaiter(this, void 0, void 0, function () {
        var spenderContractAddress;
        return __generator(this, function (_a) {
            spenderContractAddress = getContractTokenTransferAddress(networkName);
            return [2 /*return*/, erc20ContractAllowanceForAccount(web3Instance, tokenContractAddress, spenderContractAddress, from)];
        });
    });
}

var Erc20Cache = /** @class */ (function () {
    function Erc20Cache(network, token) {
        this.network = network;
        this.token = token;
    }
    Object.defineProperty(Erc20Cache.prototype, "symbol", {
        get: function () {
            return sessionStorage.getItem(this.network + ":" + this.token + ".symbol");
        },
        set: function (symbol) {
            sessionStorage.setItem(this.network + ":" + this.token + ".symbol", symbol);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Erc20Cache.prototype, "decimals", {
        get: function () {
            return sessionStorage.getItem(this.network + ":" + this.token + ".decimals");
        },
        set: function (decimals) {
            sessionStorage.setItem(this.network + ":" + this.token + ".decimals", decimals);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Erc20Cache.prototype, "name", {
        get: function () {
            return sessionStorage.getItem(this.network + ":" + this.token + ".name");
        },
        set: function (name) {
            sessionStorage.setItem(this.network + ":" + this.token + ".name", name);
        },
        enumerable: true,
        configurable: true
    });
    return Erc20Cache;
}());

var Erc20 = /** @class */ (function () {
    function Erc20(network, token, account, cache) {
        if (cache === void 0) { cache = new Erc20Cache(network, token); }
        var _this = this;
        this.network = network;
        this.token = token;
        this.account = account;
        this.cache = cache;
        this.transactionReceipt = function (transactionHash) { return __awaiter(_this, void 0, void 0, function () {
            var response, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.web3.eth.getTransactionReceipt(transactionHash)];
                    case 1:
                        response = _a.sent();
                        return [2 /*return*/, response];
                    case 2:
                        e_1 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 3: return [2 /*return*/];
                }
            });
        }); };
        var networkName = network === 'ethereum' ? 'mainnet' : network;
        this.web3 = new Web3(new Web3.providers.HttpProvider("https://" + networkName + ".infura.io/DjvHIbnUXoxqu4dPRcbB"));
    }
    Erc20.prototype.currentBlock = function () {
        return __awaiter(this, void 0, void 0, function () {
            var response, e_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, this.web3.eth.getBlockNumber()];
                    case 1:
                        response = _a.sent();
                        return [2 /*return*/, response];
                    case 2:
                        e_2 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    Erc20.prototype.decimals = function () {
        return __awaiter(this, void 0, void 0, function () {
            var response, e_3;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (this.cache.decimals) {
                            return [2 /*return*/, parseInt(this.cache.decimals, 10)];
                        }
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, erc20ContractDecimals(this.web3, this.token)];
                    case 2:
                        response = _a.sent();
                        this.cache.decimals = response;
                        return [2 /*return*/, parseInt(response, 10)];
                    case 3:
                        e_3 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    Erc20.prototype.symbol = function () {
        return __awaiter(this, void 0, void 0, function () {
            var response, e_4;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (this.cache.symbol) {
                            return [2 /*return*/, this.cache.symbol];
                        }
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, erc20ContractSymbol(this.web3, this.token)];
                    case 2:
                        response = _a.sent();
                        this.cache.symbol = response;
                        return [2 /*return*/, response];
                    case 3:
                        e_4 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    Erc20.prototype.name = function () {
        return __awaiter(this, void 0, void 0, function () {
            var response, e_5;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (this.cache.name) {
                            return [2 /*return*/, this.cache.name];
                        }
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, erc20ContractName(this.web3, this.token)];
                    case 2:
                        response = _a.sent();
                        this.cache.name = response;
                        return [2 /*return*/, name];
                    case 3:
                        e_5 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    Erc20.prototype.balance = function () {
        return __awaiter(this, void 0, void 0, function () {
            var e_6;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, erc20ContractBalanceForAccount(this.web3, this.token, this.account)];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2:
                        e_6 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    Erc20.prototype.allowance = function () {
        return __awaiter(this, void 0, void 0, function () {
            var e_7;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, allowanceUserfeedsContractTokenTransferForAccount(this.web3, this.network, this.token, this.account)];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2:
                        e_7 = _a.sent();
                        return [2 /*return*/, undefined];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    return Erc20;
}());

var MetaFox = "data:image/png;base64,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"

var Fox = styled__default.img.attrs({ src: MetaFox })(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  width: 30px;\n  height: 30px;\n"], ["\n  width: 30px;\n  height: 30px;\n"])));
var loaderAnimation = styled.keyframes(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  0% {\n    transform: rotate(0deg)\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n"], ["\n  0% {\n    transform: rotate(0deg)\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n"])));
var Loader = styled__default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 50px;\n  height: 50px;\n  border-radius: 100%;\n  border: 1px solid #ffffff;\n  border-bottom: 1px solid transparent;\n  animation: ", " 2s linear infinite;\n"], ["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 50px;\n  height: 50px;\n  border-radius: 100%;\n  border: 1px solid #ffffff;\n  border-bottom: 1px solid transparent;\n  animation: ", " 2s linear infinite;\n"])), loaderAnimation);
var MetaLoader = styled__default(function (props) { return (React__default.createElement("div", __assign({}, props),
    React__default.createElement(Fox, null),
    React__default.createElement(Loader, null))); })(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  position: relative;\n  width: 50px;\n  height: 50px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"], ["\n  position: relative;\n  width: 50px;\n  height: 50px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"])));
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;

var insufficientFundsCss = styled.css(templateObject_1$1 || (templateObject_1$1 = __makeTemplateObject(["\n  background: #fdba4f;\n  border-width: 0;\n  opacity: 0.7;\n"], ["\n  background: #fdba4f;\n  border-width: 0;\n  opacity: 0.7;\n"])));
var metamaskCss = styled.css(templateObject_2$1 || (templateObject_2$1 = __makeTemplateObject(["\n  background: #fdba4f;\n  border-width: 0;\n"], ["\n  background: #fdba4f;\n  border-width: 0;\n"])));
var disabledCss = styled.css(templateObject_3$1 || (templateObject_3$1 = __makeTemplateObject(["\n  color: #89939f;\n  background: linear-gradient(to right, #ffffff, #f5f7fa);\n  border: solid 1px #d9e0e7;\n"], ["\n  color: #89939f;\n  background: linear-gradient(to right, #ffffff, #f5f7fa);\n  border: solid 1px #d9e0e7;\n"])));
var successCss = styled.css(templateObject_4$1 || (templateObject_4$1 = __makeTemplateObject(["\n  background: rgba(9, 213, 124, 0.2);\n  color: #07bb6c;\n  border-width: 0;\n"], ["\n  background: rgba(9, 213, 124, 0.2);\n  color: #07bb6c;\n  border-width: 0;\n"])));
var errorCss = styled.css(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  background: #e90535;\n  border-width: 0;\n"], ["\n  background: #e90535;\n  border-width: 0;\n"])));
var Button = styledComponentsTS(styled__default.button)(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  cursor: pointer;\n  color: #ffffff;\n  font-weight: bold;\n  font-size: 14px;\n  padding: 10px 15px;\n  border-radius: 8px;\n  background: #263fff;\n\n  :not(:disabled) {\n    box-shadow: 0 10px 25px 0 rgba(38, 63, 255, 0.3);\n  }\n\n  :disabled {\n    cursor: not-allowed;\n  }\n\n  ", "\n  ", "\n  ", "\n  ", "\n  ", "\n"], ["\n  cursor: pointer;\n  color: #ffffff;\n  font-weight: bold;\n  font-size: 14px;\n  padding: 10px 15px;\n  border-radius: 8px;\n  background: #263fff;\n\n  :not(:disabled) {\n    box-shadow: 0 10px 25px 0 rgba(38, 63, 255, 0.3);\n  }\n\n  :disabled {\n    cursor: not-allowed;\n  }\n\n  ", "\n  ", "\n  ", "\n  ", "\n  ", "\n"])), function (props) { return (props.insufficientFunds ? insufficientFundsCss : ''); }, function (props) { return (props.disabled && !props.insufficientFunds && !props.error && !props.success ? disabledCss : ''); }, function (props) { return (props.metamask ? metamaskCss : ''); }, function (props) { return (props.error ? errorCss : ''); }, function (props) { return (props.success ? successCss : ''); });
var DefaultButton = function (_a) {
    var children = _a.children, restProps = __rest(_a, ["children"]);
    return React__default.createElement(Button, __assign({}, restProps), children);
};
var templateObject_1$1, templateObject_2$1, templateObject_3$1, templateObject_4$1, templateObject_5, templateObject_6;

var BN$1 = utils.BN;
var Button$1 = /** @class */ (function (_super) {
    __extends(Button, _super);
    function Button(props) {
        var _this = _super.call(this, props) || this;
        _this.transactionState = 'none';
        _this.settings = {
            asset: '',
        };
        _this.sendHttpClaim = function () { return __awaiter(_this, void 0, void 0, function () {
            var claim, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        claim = this.props.claim;
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        this.transactionState = 'waiting-for-confirm';
                        return [4 /*yield*/, sendClaim(web3, claim)];
                    case 2:
                        _a.sent();
                        this.transactionState = 'success';
                        return [3 /*break*/, 4];
                    case 3:
                        e_1 = _a.sent();
                        this.transactionState = 'error';
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        }); };
        _this.onClick = function () { return __awaiter(_this, void 0, void 0, function () {
            var web3Store, _a, value, claim, recepientAddress, valueInWei, promiEvent_1, promiEvent, txHash, e_2;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        web3Store = this.web3Store;
                        _a = this.props, value = _a.value, claim = _a.claim, recepientAddress = _a.recepientAddress;
                        if (this.settings.asset.startsWith('http')) {
                            this.sendHttpClaim();
                            return [2 /*return*/];
                        }
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 8, , 9]);
                        valueInWei = value ? toWei("" + value, web3Store.decimals) : '';
                        if (!(value && web3Store.shouldApprove(valueInWei))) return [3 /*break*/, 4];
                        this.transactionState = 'waiting-for-allowance';
                        return [4 /*yield*/, web3Store.approve(valueInWei)];
                    case 2:
                        promiEvent_1 = (_b.sent()).promiEvent;
                        return [4 /*yield*/, resolveOnTransactionHash(promiEvent_1)];
                    case 3:
                        _b.sent();
                        _b.label = 4;
                    case 4:
                        this.transactionState = 'waiting-for-confirm';
                        return [4 /*yield*/, web3Store.sendClaim(claim, recepientAddress, value)];
                    case 5:
                        promiEvent = (_b.sent()).promiEvent;
                        return [4 /*yield*/, resolveOnTransactionHash(promiEvent)];
                    case 6:
                        txHash = _b.sent();
                        if (this.props.onTransactionHash) {
                            this.props.onTransactionHash(txHash);
                        }
                        this.transactionState = 'submitted';
                        return [4 /*yield*/, promiEvent];
                    case 7:
                        _b.sent();
                        this.transactionState = 'success';
                        return [3 /*break*/, 9];
                    case 8:
                        e_2 = _b.sent();
                        this.transactionState = 'error';
                        return [3 /*break*/, 9];
                    case 9: return [2 /*return*/];
                }
            });
        }); };
        _this.settings.asset = "" + props.network + (props.assetAddress ? ":" + props.assetAddress : '');
        _this.web3Store = new Web3Store(web3, Erc20, _this.settings);
        mobx.reaction(function () { return _this.transactionState; }, function (state, reaction) {
            if (_this.props.onTransactionStateChange) {
                _this.props.onTransactionStateChange(state);
            }
        });
        return _this;
    }
    Button.prototype.componentWillReceiveProps = function (newProps) {
        this.settings.asset = "" + newProps.network + (newProps.assetAddress ? ":" + newProps.assetAddress : '');
    };
    Button.prototype.render = function () {
        var _a = this, web3Store = _a.web3Store, transactionState = _a.transactionState;
        var _b = this.props, value = _b.value, style = _b.style, className = _b.className, component = _b.component;
        var ButtonComponent = component || DefaultButton;
        if (transactionState === 'waiting-for-allowance' || transactionState === 'waiting-for-confirm') {
            return (React__default.createElement(ButtonComponent, { disabled: true, metamask: true, className: className, style: style },
                React__default.createElement(MetaLoader, null)));
        }
        if (transactionState !== 'none') {
            return (React__default.createElement(ButtonComponent, { disabled: true, error: transactionState === 'error', success: transactionState === 'success' || transactionState === 'submitted', className: className, style: style }, transactionState));
        }
        if (!!web3Store.reason) {
            return (React__default.createElement(ButtonComponent, { disabled: true, className: className, style: style }, web3Store.reason));
        }
        if (value && new BN$1(toWei(value, web3Store.decimals)).gt(new BN$1(web3Store.balance))) {
            return (React__default.createElement(ButtonComponent, { disabled: true, insufficientFunds: true, className: className, style: style }, "Insufficient funds"));
        }
        return (React__default.createElement(ButtonComponent, { className: className, style: style, onClick: this.onClick }, "Send"));
    };
    __decorate([
        mobx.observable
    ], Button.prototype, "transactionState", void 0);
    __decorate([
        mobx.observable
    ], Button.prototype, "settings", void 0);
    Button = __decorate([
        mobxReact.observer
    ], Button);
    return Button;
}(React.Component));

module.exports = Button$1;
