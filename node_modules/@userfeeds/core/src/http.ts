import uuidv4 from 'uuid/v4';

import { getAccounts } from './utils';

const USERFEEDS_API_ADDRESS = 'https://api.userfeeds.io';

export async function sendClaim(web3Instance, claim): Promise<string> {
  const [from] = await getAccounts(web3Instance);

  const wrappedClaim = JSON.stringify({ data: claim, creator: from.toLowerCase(), nonce: uuidv4() });
  const signatureValue = await web3Instance.eth.personal.sign(wrappedClaim, from);
  const body = JSON.stringify({ data: wrappedClaim, signatureValue, signatureType: 'ethereum:personal:sign' });
  const response = await fetch(`${USERFEEDS_API_ADDRESS}/api/create-claim`, {
    method: 'POST',
    body,
    headers: {
      'Content-Type': 'application/json',
    },
  });
  const id = await response.text();

  return id;
}
